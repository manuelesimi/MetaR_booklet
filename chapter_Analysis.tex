
%----------------------------------------------------------------------------------------
%	CHAP Analysis
%----------------------------------------------------------------------------------------

\chapterimage{blue-chapter-head_4-reduced.pdf} % Chapter heading image

\chapter{Analyses}\label{chap:Analyses}


\section{The MetaR Analysis Root Node}
MetaR analyses are represented with an Analysis AST Root node. An analysis often imports one or more tables, performs data transformations and writes a table or generates some plots. 
You can create as many Analysis root nodes as needed in a model. You create an analysis by right-clicking on a model and selecting \menu{New > o.c.metar.tables > Analysis}. Analysis can exist as direct child of a model, and for this reason is called a root node. Figure~\ref{fig:NewAnalysis} presents a new Analysis root node. 

\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthTiny]{figures/NewAnalysis.pdf}
\caption[New MetaR Analysis Root Node.]{\textbf{New MetaR Analysis Root Node.} This figure presents a freshly created MetaR analysis root node. You can press \keys{\return} over the \mpsplaceholder{} to add Statement nodes to the analysis. Use auto-completion to discover which types of statements are available. }
\label{fig:NewAnalysis}
\end{SCfigure}

\paragraph{name}
Each analysis has a name. You should name the analysis after creating it. The name you enter will be shown in the Project Tab after the \includegraphics[height={2ex}]{figures/analysis.png} icon.

\paragraph{statements}
An analysis contains a list of statements. You can enter new statements by typing between the curly brackets \texttt{\{} \texttt{\}}. 

To enter a specific statement, you can type the \texttt{alias} of the statement (for instance \texttt{import table}). When you have typed a complete alias, the node will be inserted in place of the alias. Note that there is no actual indication that the text you are typing matches a valid alias. You need to finish typing the full alias before the node is substituted for the alias. The text you type will remain red until the substitution occurs even if the text is matching a valid alias. See Figure~\ref{fig:TypingStatementAliases}.

\noindent The following sections describe the kinds of statements offered by the MetaR \texttt{org\allowbreak.campagne\allowbreak{}lab\allowbreak.MetaR\allowbreak.tables} language. The simplest way to learn which statements are supported by the release of MetaR that you are using is to use auto-completion. Figure~\ref{fig:AutoCompletionForStatements} provides a snapshot of the auto-completion menu when looking for statements to insert in the Analysis statement list. 

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/StatementAuto-completion.png}
\caption[Auto-completion Dialog for Statements.]{\textbf{Auto-completion Dialog for Statements.} This dialog is obtained by placing the cursor where a Statement is valid, and pressing \keys{\ctrl+\space}.}
\label{fig:AutoCompletionForStatements}
\end{figure}



\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/AnalysisTypingAliases.pdf}
\caption[Typing Statement Aliases.]{\textbf{Typing Statement Aliases.} The user has typed ``import'' on the third line. This text is a prefix of the import table statement, but is shown in red because the alias is not yet complete. The fourth line shows the import statement which is substituted to the text when the user has just finished typing ``import table'', the complete alias of the statement. Note that pressing \keys{\return} immediately after import will create the node if the prefix ``import'' matches a single type of node in the languages imported in this model.}
\label{fig:TypingStatementAliases}
\end{figure}

\section{Styles} \label{styles}\index{Styles}

MetaR comes with a styles language that allows to customize the graphical aspects of plots and files generated by statements. A \texttt{Style} is represented by a root node in the model with a given name. 

To create a Style, right-click on a model in the project tab and select \menu{right-click > New > o.campagnelab.styles > Style}. This will create an empty Style, as shown in Figure~\ref{fig:NewStyle}. 

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewStyle.pdf}
\caption[New Style.]{\textbf{New Style.} A newly created Style AST Root node.}
\label{fig:NewStyle}
\end{figure}

Style nodes are identified by a \includegraphics[height=2ex]{figures/style.png} icon. A Style is essentially a container for \textit{style items}. Items are well-defined settings that are applied by MetaR during the rendering of a graphical object.  Figure~\ref{fig:NewStyleWithElements} shows a snapshot of the auto-completion menu when looking for items to add to a style. All possible style items are shown because this style is not yet bound to a specific statement.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/NewStyleWithElements.png}
\caption[Adding Style Items to a Style.]{\textbf{Adding Style Items to a Style.} A Style is a container for Style Items. By using auto-completion \keys{\ctrl+\space}, style items can be added to the node.}
\label{fig:NewStyleWithElements}
\end{figure}

Styles can extend other styles, which provides an ability to modularize appearance. This is useful if you need to build collections of plots, and most plots have a subset of style attributes, but the title of each plot or the X or Y variable changes. You would define the common style attributes in a style, and extend this style each time you need to specialize the style.

\subsection{Binding Styles to Statements}

In order to use a Style, you have to bind a statement to it. There are different approaches you can follow to create this binding and the choice depends on your needs and flexibility.  

The simplest way to create a style and bind it to a statement is to use the intention "Create New Style" available on compatible statements as shown in Figure~\ref{fig:CreateStyleIntention}. This intention will create a new style and bind it to the statement. This has the advantage that the style items are immediately restricted to only the items compatible with the statement.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/CreateStyleIntention.png}
\caption[Create New Style on Statements.]{\textbf{Create New Style Intention on Statements.} The user has pressed \keys{option+\return} on a statement that can be bound to a style. By selecting the \textbf{Create New Style} intention, a new default style is created in the model and bound to the statement.}
\label{fig:CreateStyleIntention}
\end{figure}

Once bound to a statement (or more than one), the list of items that can be added to the Style is restricted to the ones compatible with the statement(s). For instance, if the style shown in Figure~\ref{fig:NewStyleWithElements} is bound to a statement that uses only a Color Palette and some kind of border drawing, the auto-completion menu will appear as shown in Figure~\ref{fig:StyleWithRestrictedItems}. 

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/StyleWithRestrictedItems.png}
\caption[Style with restricted Items.]{\textbf{Style with Restricted Items.}  A subset of Style Items is displayed in the auto-completion menu when the Style is bound to a statement.}
\label{fig:StyleWithRestrictedItems}
\end{figure}

However, styles can be created independently from statements and bound at a later time. In this case, the list of styles visible to a statement in the auto-completion menu is limited to the compatible styles available (see Figure~\ref{fig:VisibleStyles}). A style is defined compatible with a statement if its items or a subset of them are used by the statement.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/VisibleStyles.png}
\caption[Styles visible from a Statement.]{\textbf{Styles visible from a Statement.}  A statement can be bound only to Styles that define items compatible with the statement.}
\label{fig:VisibleStyles}
\end{figure}

A library of Styles could be created and reused across multiple Statements, Analyses or even Models. The capability to extends other Styles promotes reuse, reduces redundancies and allows to keep the number of Styles in a model at a minimum.  

\section{Working with Tables}

\subsection{Import Table}
The \texttt{import table} statement makes it possible to import a table, defined in the model, into the analysis. The columns of the imported table will become visible to the statements that follow the import. You can create an import table statement by typing the alias \texttt{import table} on an empty line of Analysis. Once you have bound the reference to a table, the import statement will look like this: \includegraphics[height=2ex]{figures/SomeDataImportTable.pdf}. The name in green is the name of the table the statement imports. See Section\ref{sec:CreateATable} to learn how to create a Table Root node.
\paragraph{table}

The table attribute is a reference to an AST root node. You can set this reference by typing the name of the table you wish to import, or by using auto-completion \keys{\ctrl+\space} to locate the table AST root node.

\subsection{Write Table}
MetaR analyses can create new tables. You can write the data in these tables to a file using the \texttt{write} statement (see Figure~\ref{fig:NewWriteTableStatement} for a new write statement). The write statement has two attributes: table and filename.
\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewWriteStatement.pdf}
\caption[New Write Statement	.]{\textbf{New Write Statement.} Use this statement to write the content of a table to a file.}
\label{fig:NewWriteTableStatement}
\end{SCfigure}


\paragraph{table}
This reference should be set to the table that you want to write to a file.
\paragraph{output}
The output should be set to a filename where you want the data contained in the table to be written. Notice that output has a button to let you select the output filename.

\subsection{Identify a Set of Columns}\label{subsec:KeySelectionDescription}
Several types of statements require the user to select one or more columns of a table. MetaR provides several ways to select a set of columns. 
\begin{itemize}
  \item You can use the \texttt{columns} node to identify a set of columns. 
  \item You can use the \texttt{group} node to name a single group, and identify all columns annotated with this group.
  \item You can use the \texttt{groups} node to name a set of groups, and identify all columns annotated with any of these groups.
\end{itemize}

\noindent{}Each strategy identifies a set of columns, which may contain one or more columns.

\section{Define Sets of Ids}\index{Sets of Ids}\index{define a set}\label{sec:defineSetsOfIds}
You can use this statement (alias \texttt{define Sets of Ids}) to  define a custom set of ids. Figure~\ref{fig:NewSetsOfIds} shows a new \texttt{define Sets of Ids} statement. Sets of ids can be used draw Venn diagrams (see Section~\ref{subsec:VennDiagram}), or to select rows of tables with the \texttt{subset} statement (see Section~\ref{sec:subsetStatement}).   To create a new set, use the \texttt{define} statement and choose \texttt{set of ids} with auto-completion. 

\paragraph{name}
The set of ids must have a name. The name is used to refer to this set of ids in other parts of the analysis. 

\paragraph{ids}
By pressing \keys{\return} with the cursor over the \mpsplaceholder{} attribute you can add a new id in your set. To add another id, you just have to press again \keys{\return}. Figure~\ref{fig:ExampleSetOfIds} shows an example of \texttt{Sets of Ids}.

\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthSmall]{figures/NewSetsOfIds.pdf}
\caption[New Sets of Ids.]{\textbf{New Set of Ids Statement.} Use this statement to define a custom set of ids.}
\label{fig:NewSetsOfIds}
\end{SCfigure}

\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthSmall]{figures/ExampleSetOfIds.pdf}
\caption[Example of a user defined Sets of Ids.]{\textbf{Example of a user defined Sets of Ids.} The set contains 14 elements with IDS named a-d7.}
\label{fig:ExampleSetOfIds}
\end{SCfigure}


\section{Subset Rows}\index{Subset rows}\index{Filter rows}\label{sec:subsetStatement}
You can use this statement (alias \texttt{subset rows}) to filter a table and produce a new table with a subset of the rows of the input table. Figure~\ref{fig:NewSubsetRows} shows a new \texttt{subset rows} statement.

\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewSubsetRowsStatement.pdf}
\caption[New Subset Rows Statement.]{\textbf{New Subset Rows Statement.} Use this statement to filter the rows of a table.}
\label{fig:NewSubsetRows}
\end{SCfigure}

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/ExampleSubsetRows.pdf}
\caption[Subset Rows Examples.]{\textbf{Subset Rows Examples.} This figure illustrates the two alternatives available for filtering rows: by expression (with \texttt{when true:}, or with a set of ID values).}
\label{fig:ExampleSubsetRows}
\end{figure}


\paragraph{table}
The input table reference must be set to a table. The table must be either imported or produced by another statement.
\paragraph{filter}
The filter determines which rows are kept. Use auto-completion to select one of the alternatives:
\begin{enumerate}
	\item \texttt{when true:} will keep a row when the boolean expression following when \texttt{true:} evaluates to  \texttt{true}.
	\item \texttt{with IDS} will keep a row when the value of the column marked with group \texttt{ID} exists in the list provided as an argument. See the \texttt{define} statement to create a list of IDs in Section~\ref{sec:defineSetsOfIds}. 
\end{enumerate}

\paragraph{subset}
The output table is called subset by default. Feel free to rename this table to better match the data in it.

\subsection{Example}
Figure~\ref{fig:ExampleSubsetRows} presents examples of subset row statements. 

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/ExampleSubsetRows.pdf}
\caption[Subset Rows Examples.]{\textbf{Subset Rows Examples.} This figure illustrates the two alternatives available for filtering rows: by expression (with \texttt{when true:}, or with a set of ID values).}
\label{fig:ExampleSubsetRows}
\end{figure}

\subsection{Boolean Expressions}
One form of the subset rows statement accepts a boolean expression to determine which rows to keep. Boolean expression have one of two values: true or false, and can be constructed by comparing values with an operator. The following operators are supported by MetaR:
\begin{itemize}
 \item \textbf{\$(} column \textbf{)} The value operator evaluates to the value of the column in the row currently considered.
	\item expr1 \textbf{==} expr2 true when expr1 evaluates to the same value as expr2.
	\item expr1 \textbf{!=} expr2 true when expr1 does not evaluate to the same value as expr2.
	\item expr1 \textbf{|} expr2 true when expr1 is true or expr2 is true (boolean or. either one of expr1 or expr2 needs to be true for the result to be true).
    \item expr1 \textbf{\&} expr2 true when expr1 is true and expr2 is true (boolean and, both expre1 and epr2 must be true for the result to be true).
    \item expr1 \textbf{<} expr2 true when expr1 evaluates to a value less than expr2.  
    \item expr1 \textbf{>} expr2 true when expr1 evaluates to a value greater than expr2.  
   \item expr1 \textbf{<=} expr2 true when expr1 evaluates to a value less or equal than expr2.  
    \item expr1 \textbf{>=} expr2 true when expr1 evaluates to a value greater or equal than expr2.  
\end{itemize}

\begin{remark}
MetaR infers the type of the expressions that you enter and will report type errors if the value of some values are not compatible with the test that your perform.
\end{remark}


\section{Join Tables}\index{Join Tables}
When you perform data analysis, you often need to combine data from different tables into one. This operation is called table joining. MetaR provides a powerful \texttt{join} statement that helps join an arbitrary number of tables. The alias of the statement is \texttt{join}. Figure~\ref{fig:NewJoinStatement} presents a newly created \texttt{join} statement. Join has three attributes: input tables, by and output table.

\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewJoinStatement.pdf}
\caption[New Join Statement.]{\textbf{New Join Statement.} Use this statement to join two or more tables into one.}
\label{fig:NewJoinStatement}
\end{SCfigure}

\paragraph{input tables}
Use this attribute to enter references to tables you need to join. You can press \keys{\return} with the cursor inside the parentheses to create references to additional input tables (either imported or created in the analysis up to that point).
\paragraph{by}
Use the by attribute to specify how to join the input tables. Joining tables requires knowing which rows of the input tables go together. This is done by identifying a set of columns whose values must match across rows of the input tables that go together. See Section~\ref{subsec:KeySelectionDescription} to learn how to select groups of columns in MetaR. You can select one of the following joining strategies as value of the by attribute:

\begin{itemize}
	\item \textbf{by columns:} The same column name must be defined in all the input tables.
	\item \textbf{by group:} If each table has exactly one column annotated with this group, the names of the columns do not need to be the same. Otherwise, if more than one columns is in the group, their names must match across all the tables. 
	\item \textbf{by groups:} Similar to group, but with any (>=1) number of groups. Press \keys{\return} to insert new group references.
\end{itemize}
 The group by columns are used to calculate a list of values. When rows of the input tables have the same group by values, they are joined in a single row, and the result put in the destination table. 

\begin{remark}
The join statement will create new columns if the input tables have columns with the same name. In this case the shared columns are renamed ``colname.TableName''. Place the cursor on result and look at the column preview in the inspector to see which column names are generated by a given join statement.
\end{remark}

\paragraph{result}
The output table is called Results by default. Feel free to rename this table to match the content of the destination table. Open the \inspectorTabIcon{} to see which columns will result from the join. Notice that the column groups are transferred to the columns of the output table.

\subsection{How Join works}\index{How Join Works}\index{Join}
The output table produced by the \texttt{join} statement can be very different, depending on the strategy selected to join the input tables and their structure. The statement takes also care to produce unique columns from columns common to all the input tables but not used in the joining strategy. To explain how \texttt{join} works we will apply two different strategies to the input tables (named A and B) presented in Figure~\ref{fig:SourceTablesJoinStatement} and check the structure and content of the output table.
\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/JoinA-B-SourceTable.pdf}
\caption[Sample input tables for Join Statement.]{\textbf{Sample Input Tables for Join Statement.}}
\label{fig:SourceTablesJoinStatement}
\end{figure}

Do note that the two tables have columns in common (Gene and Column2) and that each table has a column annotated with a group named ID (Column1 in table A, Column4 in table B).

\paragraph{join by column}
As first strategy, we join A and B by the column Gene. The results table generated by \texttt{join} is shown in Figure~\ref{fig:ResultsTableJoinByColumnStatement}. 

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/JoinA-BbyColumn.pdf}
\caption[Results Table for Join using by Column Strategy.]{\textbf{Results Table for Join using by Column Strategy.}}
\label{fig:ResultsTableJoinByColumnStatement}
\end{figure}


If we analyze the structure of the table, we note that:
\begin{itemize}
  \item there is only one Gene column (the one used for joining)
  \item Column2, that was present in both the input tables, was split in two columns named Column2.A and Column2.B
  \item the rest of the columns are the same coming from their respective input tables
\end{itemize} 
Looking at the table's content, we note that:
\begin{itemize}
	\item rows from input tables with a matching value in the Gene column were merged into a single row.  
	\item all the other columns keep their original value from the source table with respect to the Gene column's value
\end{itemize}



\paragraph{join by group}
Our second strategy is to join A and B by group ID. As shown in Figure~\ref{fig:SourceTablesJoinStatement}, there are two columns, one in each input table, annotated with such a group and they have different names. The \texttt{join} statement is able to work even in this case by matching the values of these two columns. The results table generated by Join is shown in Figure~\ref{fig:ResultsTableJoinByGroupStatement}. Again, let's go over the structure of the table:
\begin{itemize}
	\item Gene, that was present in both the input tables but this time not used as joining column, was split in two columns named Gene.A and Gene.B
	\item Column2, that was present in both the input table, was again split in two columns named Column2.A and Column2.B
    \item the rest of the columns are the same coming from their respective input tables
\end{itemize}
\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/JoinA-BbyGroup.pdf}
\caption[Results Table for Join using by Group Strategy.]{\textbf{Results Table for Join using by Group Strategy.}}
\label{fig:ResultsTableJoinByGroupStatement}
\end{figure}

Looking at the table's content, we note that:
\begin{itemize}
	\item rows from input tables with a matching value in Column1 from A and Column4 from B were merged into a single row
	\item all the other columns keep their original value from the source table with respect to their matching column's value
\end{itemize}


\subsection{Example Join}\index{Example}\index{Join}

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/ExampleJoin.pdf}
\caption[Example of Join Statement.]{\textbf{Example of Join Statement.}}
\label{fig:ExampleJoinStatement}
\end{figure}

\begin{figure}[h!bp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/ExampleJoinColumnPreview.pdf}
\caption[Column Preview for Result Table.]{\textbf{Column Preview for Result Table.} Notice that all these columns were shared across the input tables because their name follows the pattern ``colName.tableName''.}
\label{fig:ColumnPreviewExample}
\end{figure}

Figure~\ref{fig:ExampleJoinStatement} presents an example of join statement. The statement joins two tables and creates the Result table. If you open the \inspectorTabIcon{}, you will see a preview of the columns for the result table (shown in Figure~\ref{fig:ColumnPreviewExample}). 



\section{Transform Table}\index{Transform Table}
The statement transform table (alias \texttt{transform})  allows to transform columns of an input table and produce a new table. Figure~\ref{fig:NewTransformTable} shows a new \texttt{transform} statement.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewTransformTable.pdf}
\caption[New Transform Table  Statement.]{\textbf{New Transform Table Statement.} Use this statement to transform a table by applying column operations.}
\label{fig:NewTransformTable}
\end{figure}

\paragraph{table}
Use this attribute to select a table to transform. You can press \keys{\ctrl+\space} to open the autocompletion menu and display all available tables.

\paragraph{operations}
A set of table operations, which can be used to transform the input table. See Figure~\ref{fig:TransformTable} for a list of operations  available to transform a table. Operations include: 

\subparagraph{drop column} This operation allows to delete a specific column. Press \keys{\ctrl+\space} to open the autocompletion menu and display all available columns. Then press  \keys{\return} to select one column. This column will be removed/dropped in the result table.

\subparagraph{drop columns which match} This operation allows to delete columns which contains a specific pattern. Type the pattern after the \texttt{match} keyword.

\subparagraph{drop columns which have group} This operation allow to delete columns which have a specific group. To do so, press first \keys{\ctrl+space} to display the available group and \keys{\return} to select one group.

\subparagraph{add column}
This operations allows to add a column in the result table. Start by entering the name of the new column. The second argument must contain the expression that will calculate the value that the new column will take for each row of the result table. You may reference columns of the input table in the expression using the \texttt{\$} column selection helper.  

\subparagraph{rename} this operation allows to rename a specific column from the input table. Once you have selected your column of interest, you just need to type a new name under the \textit{(newName)} argument.

\paragraph{result}
The output table is called TransformedTable by default, but can be renamed as needed. Use the inspector to see which columns will be produced when the transform statement is executed.


\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/TransformTable.pdf}
\caption[Example of Transform Table Statement.]{\textbf{Example of Transform Table Statement.} This example show various table operations available with \texttt{transform table}.}
\label{fig:TransformTable}
\end{SCfigure}

\section{Block with Selected Tables}\index{Block with Tables}
Sometimes it can happen that many tables are created during your analysis and, at one point, you might want to work with a restricted set of tables.
The statement \texttt{with tables} allows you to select specific tables defined in your analysis and execute metaR statements on them.
Figure~\ref{fig:NewWithTablesStatement} presents a newly created \texttt{with tables} statement. All tables created inside the block will be available outside the block.
The statement has two attributes: the list of input tables and a statement list. Figure~\ref{fig:ExampleWithTablesStatement} shows an example of the \texttt{with tables} statement.

\paragraph{input tables}
Use this attribute to select the tables you want to see inside the block. To do so, you can use auto-completion and select tables defined in your analysis up to that point. The statements included in the statement list will only see the tables defined in this list. 

\paragraph{statement list}
Here you can use all statements defined in MetaR. Any tables or plots created in the statement list will be visible after the block ends.
 
\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewWithTablesStatement.pdf}
\caption[New With Tables Statement.]{\textbf{New With Tables Statement.} Use this statement to work with a restricted set of tables.}
\label{fig:NewWithTablesStatement}
\end{figure}

 \begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/ExampleWithTablesStatement.pdf}
\caption[Example of With Tables Statement.]{\textbf{Example of With Tables Statement.}}
\label{fig:ExampleWithTablesStatement}
\end{figure}

\section{Plotting Data}
MetaR provides simple plotting capabilities\footnote{These capabilities are simple, but can be extended very easily by adding new statements to draw other types of visualization. This is a key advantage of using Language Workbench technology.}. The following types of plots are currently supported: 
\begin{itemize}
  \item boxplot alias \texttt{boxplot}
  \item histogram alias \texttt{histogram}
  \item scatterplot: alias \texttt{fit}
  \item heatmap, alias \texttt{heatmap}
  \item multiplot alias \texttt{multiplot}, makes it possible to organize other plots in a matrix of n columns by n rows.
\end{itemize}
Each type of plot statement will create a plot, identified with the \includegraphics[height=2ex]{figures/plot.png} icon when you are trying to auto-complete a reference to a plot. Plot names are also colored with the same dark blue as the icon.

Generated plots can be customized and refined by binding each statement to a style (see \ref{styles}). A reference to a style is back-colored with the same turquoise color as the  \includegraphics[height=2ex]{figures/style.png} icon.

\subsection{boxplot}\index{BoxPlot}
Figure~\ref{fig:NewBoxPlot} presents a new boxplot statement.

\begin{SCfigure}
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewBoxplot.pdf}
\caption[New Boxplot Statement.]{\textbf{New Boxplot Statement.}}
\label{fig:NewBoxPlot}
\end{SCfigure}

\paragraph{columns}
Indicate one or more columns to plot. The values of the columns will be plotted as individual boxplots in the same graph. Press \keys{\enter} to define more than one column. Use auto-completion to locate individual columns from the imported tables, or the tables created by prior statements. 

\paragraph{plot}
The attribute after \texttt{->} is a plot. Enter a name for the boxplot here. Plot names are colored blue to make them easier to recognize.

\paragraph{style} \label{ColorPaletteDesc}
If a style is bound to the box plot (see section \ref{styles}),  the statement will use a \texttt{Color\allowbreak{}Palette} item from the style to draw the plot. A Color Palette is an AST Root Node identified with the  \includegraphics[height=2ex]{figures/palette.png} icon. 

MetaR comes with several pre-defined palettes and colors ready for use. Figure shows the auto-completion menu for a Color Palette item listing the default palettes available.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/ColorPaletteItem.png}
\caption[Color Palette Item.]{\textbf{Auto-completion menu with default Color Palettes.}}
\label{fig:ColorPaletteItem}
\end{figure}

You can create a new palette by right-clicking on a model and selecting \menu{New > o.campagnelab.styles > Color Palette}. \texttt{Colors} can be added to a palette and their order will matter in the rendering of the plot. Figure \ref{fig:ColorItem} shows a Color Palette with some color items and the auto-completion menu listing some of the default colors available.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/ColorItem.png}
\caption[Color Item.]{\textbf{Auto-completion menu showing some default Colors and the \#\#RRGGBB option.} The auto-completion menu lists the visible \texttt{Colors} and \texttt{\#RRGGBB} option. By selecting this latter, you can create a custom color based on the Red Green Blue color components (RGB).}
\label{fig:ColorItem}
\end{figure}

There are two classes of colors you can use in a palette:
\begin{itemize}
\item \textbf{Named \texttt{Colors}.} New named \texttt{Colors} can be created by right-clicking on a model and selecting \menu{New > o.campagnelab.styles > Color}. A color is identified by the \includegraphics[height=2ex]{figures/color.png} icon and its name must be valid in the R language.
\item \textbf{\texttt{\#RRGGBB} Colors.} These colors can be created directly inside the Color Palette by selecting the \texttt{\#RRGGBB} option in the auto-completion menu for a Color value. The color will be constructed from the combination of the Red, Green and Blue specified in the code.
\end{itemize} 

\subsection{histogram}\index{Histogram}
Use this statement to plot a histogram of the values of one column.
\paragraph{column}
Indicate one column to plot a histogram for. Use auto-completion to locate the column from the imported tables, or the tables created by prior statements. 

\paragraph{plot}
The attribute after \texttt{->} is a plot. Enter a name for the histogram here. Plot names are colored blue to make them easier to recognize.

\paragraph{style}
The statement uses a \texttt{Color\allowbreak{}Palette} item (see \ref{ColorPaletteDesc}) from the associated style (see section \ref{styles}) to draw the plot. 

\subsection{fit x by y}
Use this statement (alias \texttt{fit}) to plot a scatter plot of x (one column) vs y (another column). A fit is performed, and the R2 adjusted, and P-value corresponding to the linear regression is shown on the plot. Figure~\ref{fig:NewFitXByY} presents a new \texttt{fit} statement.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/NewFitXByY.pdf}
\caption[New Fit X by Y.]{\textbf{New Fit X by Y.}}
\label{fig:NewFitXByY}
\end{figure}

\paragraph{x, y}
Indicate which columns should be plotted. Use auto-completion to locate the x and y columns from the imported tables, or the tables created by prior statements. 

\paragraph{plot}
The attribute after \texttt{->} is a plot. Enter a name for the scatterplot here. Plot names are colored blue to make them easier to recognize.

\paragraph{style}
The fit statement uses the following items from the associated style (see section \ref{styles}) to customize the scatterplot:
\begin{itemize}
\item \textbf{ \texttt{Title}}. The main title on top of the plot.
\item \textbf{ \texttt{X label}}. A title for the x axis.
\item \textbf{ \texttt{Y label}}. A title for the y axis.
\item \textbf{ \texttt{X range}}. Range of values for the x axis.
\item \textbf{ \texttt{Y range}}. Range of values for the y axis.
\item \textbf{ \texttt{Width}}. Width in pixels of the output image with the plot.
\item \textbf{ \texttt{Height}}. Height in pixels of the output image with the plot. 
\end{itemize}

\subsection{heatmap}\index{Heatmap}
Heatmaps are frequently used to visualize high-throughput data~\cite{Cook2007}. Use the \texttt{heatmap} statement (alias \texttt{heatmap}) to construct a heatmap plot. Figure~\ref{fig:NewBuildHeatmap} presents a new \texttt{heatmap} statement.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/NewBuildHeatmap.pdf}
\caption[New Heatmap.]{\textbf{New Build Heatmap.} Notice the intention ``Add Annotations'' attached to the statement. You can use this intention to further customize the heatmap.}
\label{fig:NewBuildHeatmap}
\end{figure}

\paragraph{table}
Specify the table that contains the data that will be used to draw the heatmap. Note that the table must meet certain conditions. An error message will be displayed if these conditions are not met:

\begin{itemize}
  \item Some columns of the table must be annotated with at least one group whose usage is ``heatmap''. Such columns are used to provide data values for the heatmap. If you don't have a heatmap usage, just create one and add it to the groups you would like to include on the heatmap.
  \item The columns of the table must be annotated with groups and group usages to make it possible for you to use these group usages to construct a legend.
\end{itemize}

\paragraph{select data by}
Use this attribute to customize the set of columns to plot on the heatmap. See Section~\ref{subsec:KeySelectionDescription} to learn how to select a set of columns.

\paragraph{plot}
The \texttt{<no name>} attribute listed after \texttt{->} makes it possible to name the plot that will hold the heatmap. Use any name you like. This name will be used to refer to the heatmap plot, for instance if you wish to assemble panels of different heatmaps into one figure.

\paragraph{style}
The statement uses the following items from the associated style (see section \ref{styles}) to customize the heatmap:
\begin{itemize}
\item \textbf{ \texttt{Color palette}}. The colors to use in the heat map (see \ref{ColorPaletteDesc}).
\item \textbf{ \texttt{Draw border}}. A boolean value to enable or disable borders in the heatmap. A value of \texttt{true} will draw a border. A value of \texttt{false} will not. By default, borders are enabled.
\item \textbf{ \texttt{Border color}}. The color to use for the border (see section \ref{ColorPaletteDesc} to check out how to create/refer to colors). If not set, the default color is \emph{grey60}.
\end{itemize}
\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/heatmap_Example.pdf}
\caption[Example of Heatmap Plot.]{\textbf{Example of Heatmap Plot.} This heatmap has been customized with annotations. The \texttt{LPS\_Treatment} group usage is shown in the legend, with two groups: \texttt{LPS=yes} and \texttt{LPS=no}. The values plotted have been scaled by rows, and the rows clustered. Data are from \url{http://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE59364}.}
\label{fig:ExampleHeatmapPlot}
\end{figure}
\paragraph{annotations}
You can use the ``Attach Annotations'' intention (\intentionLightBulb) when the cursor is on top of \texttt{heatmap} to customize heatmap annotations. Figure~\ref{fig:BuildHeatmapWithAnnotations} shows a heatmap statement with annotations.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/NewBuildHeatmapWithAnnotations.pdf}
\caption[Heatmap With Annotations.]{\textbf{Build Heatmap With Annotations.} Annotations are shown after you have triggered the ``Add Annotations'' intention.}
\label{fig:BuildHeatmapWithAnnotations}
\end{figure}

\subparagraph{\textbf{annotate with these groups.}} You can use this attribute to select usage names that should be listed in the heatmap legend. Listing a group usage will annotate each column of data with the group that is associated to the usage.
\subparagraph{\textbf{scale values.}} You can choose to scale values by column or by row. Scaling will make differences easier to see by using colors more effectively.
\subparagraph{\textbf{cluster columns:}} You can choose to cluster by colors or by rows by changing the boolean values accordingly.

\subsubsection{Example}\index{Example}

Figure~\ref{fig:ExampleHeatmapPlot} presents a heatmap constructed with the build heatmap statement, using annotations and row clustering. 

\subsection{Venn diagram}\index{Venn Diagram}\label{subsec:VennDiagram}\index{New in MetaR 1.3}
\begin{remark}
The Venn diagrams were introduced in MetaR version 1.3.
\end{remark}

Venn diagrams are useful to show how many elements exist in various intersections among sets of elements~\cite{venn1880diagrammatic}.  Use the \texttt{Venn diagram} statement (alias \texttt{venn}) to draw a Venn diagram plot. Figure~\ref{fig:NewVennDiagram} presents a new \texttt{Venn diagram} statement. 


\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/NewBuildVennDiagram.pdf}
\caption[New Venn Diagram.]{\textbf{New Venn Diagram.} Up to five sets can be shown on a Venn diagram. The name of each set will be shown on the Venn diagram plot.}
\label{fig:NewVennDiagram}
\end{figure}

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/SetsVennDiagram.pdf}
\caption[Sets type of venn diagram.]{\textbf{Sets type of Venn Diagram.} Here you can see  the two types of sets which can be used for a Venn diagram: a user defined set and a set from an annotated table.}
\label{fig:SetsVennDiagram}
\end{figure}

\paragraph{name}
The \texttt{name} attribute can be specified immediately after the \texttt{set} keyword. A set must have a name, which will be shown on the Venn diagram to identify this particular set.

\paragraph{set}
Up to five sets can be shown on a Venn diagram. The data set are divided in two types:
\begin{description}
\item[ids from a user defined set] contains only one attribute: \texttt{set of ids}. The \texttt{set of ids} attribute must refer to a user defined set. see Section~\ref{sec:defineSetsOfIds} to learn how to define new sets of ids.

\item[ids from an annotated table]  contains two attributes:
\begin{itemize}
\item \texttt{table}. This attribute must refer to a table annotated with an \textit{"ID"} group on a column that will provide identifiers for the set elements. 
\item \texttt{expression}. This expression defines how to select rows of the table to extract ids for the set. The expression must return true when a row of the table is part of the set. When this is the case, the value of the column marked with the ID group is extracted and added to the elements of the set.
\end{itemize}
\end{description}

\begin{remark}
Notice that you can turn one type of ids into the other with auto-completion. place the cursor on top of the \texttt{set} keyword and invoke \keys{\ctrl+SPACE} to switch the type of set.  Notice that the name and color attributes, if defined, are preserved.
\end{remark}


\paragraph{color}
The \texttt{default color} attribute listed after \textbf{with} makes it possible to customize the color used to draw the set on the Venn diagram. By using auto-completion, a menu listing the default colors available will appear. Default colors will be used for each set where a color has not been defined.

\paragraph{plot}
The \texttt{<no name>} attribute listed after \texttt{->} makes it possible to name the plot that will hold the Venn diagram. Use any name you like. This name will be used to refer to the Venn diagram plot.

\subsubsection{Example}\index{Example, Venn diagram}
\begin{figure}[h!tbp]
  \centering
  \includegraphics[scale=0.8]{figures/Venn3Sets.pdf}
\caption[Example of Venn Diagram with Three Sets.]{\textbf{Example of Venn Diagram with Three Sets.}}
\label{fig:Plot3SetsVennDiagram}
\end{figure}

Figure~\ref{fig:Plot3SetsVennDiagram} presents an example of a Venn Diagram showing three sets.


\subsection{multiplot}\index{Multiplot}
This statement (alias \texttt{multiplot}) makes it possible to assemble a plot as a matrix of $m$ x $n$ plots. This is convenient if you would like to create a figure from panels of individual plots. In addition, multiplot provides a preview of the multi-panel plot that you can turn on and off at the click of a button. Figure~\ref{fig:NewMultiplot} presents a new Multiplot.


\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/NewMultiplot.pdf}
\caption[New Multiplot Statement.]{\textbf{New Multiplot Statement.} Click on the Preview/Hide Preview button to toggle the plot preview.}
\label{fig:NewMultiplot}
\end{figure}

\paragraph{plot}
The plot name is shown immediately after \texttt{->} (initially \texttt{<no name>}). Name the mutliplot to be able to refer to it from other statements (such as render to make a PDF from it).
\paragraph{$m$ cols x $n$ rows}
Define the number of columns and rows that you wish the multiplot to have. 
The product of $m$ and $n$ determines how many plot references must be filled in to construct the multiplot.

\paragraph{Preview/Hide Preview}
These buttons will make it possible to preview/ hide the preview for the multiplot. Note that a preview is only available after you have run the analysis. If you don't see the image being refreshed after running the script, remember to hide the preview and show it again to refresh.

\paragraph{plot references}
After you set the number of columns and rows, you need to link  $m$ x $n$ references to plots that you have already constructed. Do this in table attribute (shown as \texttt{<<emptyTable>>} initially).


\subsubsection{Multiplot Example}
Figure~\ref{fig:ExampleMultiplot} presents an example of multiplot.

\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthWide]{figures/MutliplotExample.png}
\caption[Example of Multiplot.]{\textbf{Example of Multiplot.} This example shows a multiplot composed of two columns and one row. In the preview,  a fit x by y plot is shown on the left, and a heatmap on the right. }
\label{fig:ExampleMultiplot}
\end{figure}

\subsection{render}\index{Render}
This statement (alias \texttt{render}) makes it possible to save a plot or a multiplot in a local file according to a selected output format and style. Figure~\ref{fig:NewRender} presents a new Render.


\begin{figure}[h!tbp]
  \centering
  \includegraphics[width=\figWidthNarrow]{figures/NewRender.pdf}
\caption[New Render Statement.]{\textbf{New Render Statement.}}
\label{fig:NewRender}
\end{figure}

\paragraph{plot}
The \texttt{<no plot>} attribute listed after the alias allows you to select the plot or multiplot to render.    

\paragraph{rendering format}
The rendering format is the format in which the plot will be stored on the file system. The current version of MetaR allows to use only PDF as format. 

\paragraph{path}
The \texttt{<no path>} attribute has to be set to a filename where you want the rendering is stored. Its extension must be compatible with the selected format (e.g. ".pdf" for PDF). If only a filename is specified

\paragraph{style}
  
